
<!doctype html>
<html lang="ru" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../../assets/img/favicon.ico">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.6">
    
    
      
        <title>Удалённый сервер - python 101 course</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6910b76c.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.196e0c26.min.css">
        
          
          
          <meta name="theme-color" content="#000000">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="black" data-md-color-accent="indigo">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Перейти к содержанию
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="python 101 course" class="md-header-nav__button md-logo" aria-label="python 101 course">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            python 101 course
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Удалённый сервер
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Поиск" placeholder="Поиск" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          

  

<nav class="md-tabs md-tabs--active" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  
    <li class="md-tabs__item">
      
      
      <a href="../../week1/bash/" class="md-tabs__link">
        Первая неделя
      </a>
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
      
      <a href="../../week2/github/" class="md-tabs__link">
        Вторая неделя
      </a>
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
      
      <a href="../../week3/vscode/" class="md-tabs__link">
        Третья неделя
      </a>
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
      
      <a href="../../week4/api/" class="md-tabs__link">
        Четвертая неделя
      </a>
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
      
        
      
      <a href="./" class="md-tabs__link md-tabs__link--active">
        Пятая неделя
      </a>
    </li>
  

      
        
      
        
      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="python 101 course" class="md-nav__button md-logo" aria-label="python 101 course">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    python 101 course
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1" >
    <label class="md-nav__link" for="nav-1">
      Первая неделя
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Первая неделя" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        <span class="md-nav__icon md-icon"></span>
        Первая неделя
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../week1/bash/" class="md-nav__link">
      Линукс и Баш
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../week1/git/" class="md-nav__link">
      Гит и Гитхаб
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" >
    <label class="md-nav__link" for="nav-2">
      Вторая неделя
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Вторая неделя" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        Вторая неделя
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../week2/github/" class="md-nav__link">
      GitHub Flow и ветки
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../week2/bash-scripting/" class="md-nav__link">
      Bash-скриптинг
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" >
    <label class="md-nav__link" for="nav-3">
      Третья неделя
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Третья неделя" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        Третья неделя
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../week3/vscode/" class="md-nav__link">
      Настройка окружения
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../week3/python-intro/" class="md-nav__link">
      Основы Python
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../week3/if-for/" class="md-nav__link">
      Ветвления и итерации
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" >
    <label class="md-nav__link" for="nav-4">
      Четвертая неделя
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Четвертая неделя" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        Четвертая неделя
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../week4/api/" class="md-nav__link">
      Интерфейсы и API
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../week4/telegram-api/" class="md-nav__link">
      Telegram API
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    <label class="md-nav__link" for="nav-5">
      Пятая неделя
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Пятая неделя" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        Пятая неделя
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Удалённый сервер
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Удалённый сервер
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Содержание">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Содержание
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    Создание сервера
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    Первоначальная настройка сервера
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    Запуск бота на сервере
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    Полезные сервисы
  </a>
  
    <nav class="md-nav" aria-label="Полезные сервисы">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#uptime-robot" class="md-nav__link">
    Uptime Robot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sentry" class="md-nav__link">
    Sentry
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    Что дальше?
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../wtf/" class="md-nav__link">
      Что здесь происходит?
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../done/" class="md-nav__link">
      Что значит «сделать»
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Содержание">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Содержание
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    Создание сервера
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    Первоначальная настройка сервера
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    Запуск бота на сервере
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    Полезные сервисы
  </a>
  
    <nav class="md-nav" aria-label="Полезные сервисы">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#uptime-robot" class="md-nav__link">
    Uptime Robot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sentry" class="md-nav__link">
    Sentry
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    Что дальше?
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Удалённый сервер</h1>
                
                <h2 id="_1">Создание сервера</h2>
<p>Пришло время настроить собственный удалённый сервер. </p>
<p>Вспомним, что можно купить, воткнуть в розетку и настроить <a href="https://www.raspberrypi.org/products/">https://www.raspberrypi.org/products/</a>, и на первых порах этого будет достаточно, однако если дома выключат свет или отключат интернет, то будет неприятно. А ещё при большой нагрузке (например, если запущенным на сервере ботом начнет пользоваться большое количество людей) такое слабое железо не будет справляться и всё упадёт. </p>
<p>Хороший вариант — платить несколько баксов в месяц за аренду облачного сервера, который и работает бесперебойно, и масштабируется в случае больших нагрузок. Среди популярных решений можно выделить:</p>
<p>Digital Ocean (<a href="https://digitalocean.com">https://digitalocean.com</a>)</p>
<p>Amazon Web Services (<a href="https://aws.amazon.com">https://aws.amazon.com</a>)</p>
<p>Google Cloud Platform (<a href="https://cloud.google.com/">https://cloud.google.com</a>)</p>
<p>Яндекс.Облако (<a href="https://cloud.yandex.ru/">https://cloud.yandex.ru</a>)</p>
<p>У DO приятный интерфейс и очень крутые туториалы на русском языке по самым частым кейсам, AWS самый популярный, GCP немного сложный в настройке, а Я.Облако русскоязычный и там крутая служба поддержки, которая подробно отвечает на все вопросы в течение суток. </p>
<p>Выбрать можно любой. Каждый сервис предоставляет 2 месяца бесплатного пробного периода, чтобы принять решение о дальнейшем использовании. Можно попробовать все четыре по два месяца и потом определиться с выбором. Если не знаешь, с чего начать → начни с Digital Ocean, они норм :) </p>
<p>Если ты студент, то обязательно регистрируйся на GitHub Student Developer Pack: <a href="https://education.github.com/pack">https://education.github.com/pack</a>. Получишь бесплатный доступ на 10 месяцев на Digital Ocean + огромное количество других сервисов, которые дают бесплатный доступ на период обучения. Нужно будет отправить фотку студенческого билета с учебной почты и подождать несколько дней. </p>
<p>Регистрация и создание сервера сводится примерно к следующему: указываешь свою почту или телефон, подтверждаешь их, вводишь данные карты, у тебя списывается что-то вроде $1 и сразу же возвращается (это нужно, чтобы проверить платежеспособность). После успешной регистрации нужно создать виртуальную машину — так называется удаленный сервер (в DO это называется "дроплет"), при создании спросят всякие характеристики железа, выбирай минимальные, потом можно будет увеличить. Операционную систему можно выбрать любую, новичкам рекомендуется Ubuntu, её мы и будем использовать в курсе. </p>
<p>При создании виртуальной машины есть опция подключения по ssh-ключу, обязательно выбирай этот способ. Он заключается в том, что ты генерируешь у себя на компьютере две половинки ssh-ключа (публичный и приватный), одну часть закидываешь на сервер, а вторую держишь на своем компе и никому не показываешь. При подключении две половинки соединяются и ты получаешь доступ, таким образом на сервер может зайти только тот, у кого есть ключ. Рекомендуется сохранить этот ключ дополнительно где-нибудь в надеждом месте, например, на флешке. </p>
<p>Погугли "как сгенерировать ssh ключ", при генерировании обязательно указывай passphrase, это дополнительный пароль, он нужен для того, чтобы даже если кто-то украдёт вторую часть ключа, он не сможет попасть на сервер не зная пароль от этого ключа. После успешного создания виртуальной машины у тебя будет публичный адрес сервера (хост), пара логин-пароль или ssh-ключ для подключения (сохрани их в надеждом месте). </p>
<p>В общем, выбери один из облачных сервисов, зарегистрируйся и создай виртуальную машину (сервер). Если ты успешно смог подключиться к созданному серверу по ssh, как в первом уроке, значит всё окей и можно двигаться дальше. Если что-то пошло не так — пиши в чат!</p>
<h2 id="_2">Первоначальная настройка сервера</h2>
<p>Первое, что нужно сделать — убедиться, что ты не сидишь под <strong>root</strong>'ом. root — это пользователь под номером 001, который обладает неограниченными правами, то есть может совершать на сервере любые действия.  Некоторые сервисы делают это за тебя, некоторые нет. Набери команду <code>whoami</code> и убедись, что ты не рут. В противном случае нужно создать нового пользователя командой:</p>
<div class="codehilite"><pre><span></span><code>adduser dima
</code></pre></div>

<p>И наделить его правами суперпользователя:</p>
<div class="codehilite"><pre><span></span><code>usermod -aG sudo dima
</code></pre></div>

<p>Второе, что нужно сделать — отключить аутентификацию по паролю. Это делается очень просто — открываешь на редактирование файл <code>/etc/ssh/sshd_config</code>, находишь нужную строчку и выставляешь "no" напротив:</p>
<div class="codehilite"><pre><span></span><code>PasswordAuthentication no
</code></pre></div>

<p>Затем перезагружаешь ssh-демон командой:</p>
<div class="codehilite"><pre><span></span><code>sudo systemctl restart ssh
</code></pre></div>

<p>Демоном в Линукс называется любая постоянно запущенная программа, а systemctl — это утилита для работы с ними.</p>
<p>Теперь переподключившись как пользователь dima, ты всё так же сможешь выполнять команды как администратор, но важные команды придётся снабжать приставкой sudo, то есть если ты, например, захочешь добавить ещё одного пользователя, то вот так:</p>
<div class="codehilite"><pre><span></span><code>sudo adduser diana
</code></pre></div>

<p>Но есть один момент, так как мы отключили аутентификацию по паролю, пользователь diana никак не сможет попасть на сервер. Чтобы это исправить, надо попросить у Дианы её <strong>публичный</strong> ssh-ключ и скопировать его в файл <code>~/.ssh/authorized_keys</code>. Теперь всё ок.</p>
<p>Теперь включаем файрволл, это базовое средство защиты сервера от несанкционированного доступа. Разрешим подключение к серверу только через ssh:</p>
<div class="codehilite"><pre><span></span><code>ufw allow OpenSSH
ufw <span class="nb">enable</span>
</code></pre></div>

<p>Теперь файрволл блокирует все подключения, кроме ssh. Отлично, минимальный уровень безопасности настроен. </p>
<p>Следующим шагом идёт обновление системы. В системе Ubuntu используется менеджер пакетов APT, это что-то вроде pip'а в Питоне. Перед тем, как устанавливать что-то через менеджер пакетов APT, нужно обновить его индекс (это локальная база данных, в которой хранятся версии всех пакетов), делается это командой:</p>
<div class="codehilite"><pre><span></span><code>sudo apt update
</code></pre></div>

<p>Затем непосредственно обновляем все установленные в системе пакеты командой:</p>
<div class="codehilite"><pre><span></span><code>sudo apt upgrade -y
</code></pre></div>

<p>Ключ <code>-y</code> означает yes, он нужен, чтобы на все возникающие при обновлении вопросы автоматически отвечалось yes. </p>
<p>Готово, теперь можно ставить на сервер python и git: </p>
<div class="codehilite"><pre><span></span><code>sudo apt install python3-pip python3-venv git -y
</code></pre></div>

<p>Эта команда установит третью версию python, модули pip и venv и git. </p>
<h2 id="_3">Запуск бота на сервере</h2>
<p>Клонируй свой проект с ботом командой:</p>
<div class="codehilite"><pre><span></span><code>git clone ...
</code></pre></div>

<p>Перейди в него, активируй виртуальное окружение и установи зависимости:</p>
<div class="codehilite"><pre><span></span><code>python3 -m venv venv
<span class="nb">source</span> venv/bin/activate
python -m pip install -r requirements.txt
</code></pre></div>

<p>И запусти бота. Всё должно работать. </p>
<p>Остался ещё один шаг — нужно сделать так, чтобы бот автоматически стартовал при перезапуске сервера и автоматически поднимался в случае падения. В этом нам поможет <strong>systemd</strong> — системный менеджер, он управляет всеми процессами. </p>
<p>Поручим systemd следить за нашим ботом, создадим сервис (так называются запущенные программы, за которыми надо следить).</p>
<p>Создай файл <code>bot.service</code> в директории <code>/etc/systemd/system</code>:</p>
<div class="codehilite"><pre><span></span><code><span class="o">[</span>Unit<span class="o">]</span>
<span class="nv">Description</span><span class="o">=</span>My telegram bot
<span class="nv">After</span><span class="o">=</span>network.target

<span class="o">[</span>Service<span class="o">]</span>
<span class="nv">User</span><span class="o">=</span>root
<span class="nv">ExecStart</span><span class="o">=</span>/usr/bin/python3 /home/dima/mybotrepo/bot.py
<span class="nv">RestartSec</span><span class="o">=</span><span class="m">10</span>
<span class="nv">Restart</span><span class="o">=</span>always

<span class="o">[</span>Install<span class="o">]</span>
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</code></pre></div>

<p>Первые две команды — это просто описание сервиса и указание запускать его только после того, как будут запущено подключение к сети.</p>
<p>Далее User — от чьего имени запускать сервис, измени на своё текущее имя пользователя.</p>
<p>ExecStart — путь до интерпретатора питона (можно узнать его командой <code>which python</code>) и путь до файла, запускающего бота. </p>
<p>Две команды про перезапуск:</p>
<p>RestartSec таймаут перезапуска и Restart — политика перезапуска. В нашем случае будет перезапускаться всегда, каждые 10 секунд. </p>
<p>Последняя строчка про то, к какому классу отнести этот юнит, для группировки юнитов по классам, не бери в голову.</p>
<p>И, наконец, выполни в терминале:</p>
<div class="codehilite"><pre><span></span><code>systemctl daemon-reload
systemctl <span class="nb">enable</span> bot
systemctl start bot
systemctl status bot
</code></pre></div>

<p>Здесь мы перезапустили список демонов, сказали что сервис bot должен работать постоянно, запустили его и вывели статус. Если статус active, значит всё окей — systemd теперь следит за ним и будет поддерживать постоянную работу! </p>
<p>Теперь некоторые полезные сервисы.</p>
<h2 id="_4">Полезные сервисы</h2>
<h3 id="uptime-robot">Uptime Robot</h3>
<p>Uptime Robot — замечательный сервис, который будет тестировать твой сервис из вне: пинговать его каждые 5 минут, и в случае, если не получит ответа, отправит тебе сообщение на почту или в телеграм. Для этого нужно подтвердить почту или нажать <code>/start</code> их боту. Там есть удобная статистика и всё это бесплатно! </p>
<p>Зайди на <a href="https://uptimerobot.com/">https://uptimerobot.com</a> и зарегистрируйся. После подтверждения почты ты сможешь залогиниться и увидишь зеленую кнопку <code>Add New Monitor</code> — нажимай. Придумай монитору имя, например "Сервер Digital Ocean" (оно будет отображаться в списке мониторов слева на дашборде), укажи хост, справа выбери куда тебя оповещать о сбоях в работе:</p>
<p><img alt="" src="/img/uptime-robot-settings.png" /></p>
<p>Нажми Save Changes. Готово, теперь Uptime Robot будет мониторить твой сервер и рисовать такую красивую статистику:</p>
<p><img alt="" src="/img/uptime-robot-monitor.png" /></p>
<p>Теперь проверь, что мониторинг работает — зайди в настройки виртуальной машины (дроплета) и потуши сервер, в зависимости от того, какой сервис ты используешь, там будет что-то похожее на "остановить" или "stop", в общем найдёшь. Если в течение пяти минут на почту и в Телеграм пришло уведомление о том, что монитор IS DOWN, значит всё работает. Если не пришло, то нужно пройти в Settings и подтвердить почту/активировать бота в телеграме, чтобы он мог отправлять уведомления. Не забудь запустить сервер обратно. :) </p>
<p>Кстати, совет на будущее — виртуальную машину (дроплет) можно останавливать на время, а потом снова запускать. Лучше всего это делать, когда сервер не используется, позволяет сэкономить деньги.</p>
<h3 id="sentry">Sentry</h3>
<p>Sentry — крутая штука, которая тоже мониторит, но не сервер, а ошибки в работе твоего запущенного приложения (например, бота) и тоже присылает уведомления/рисует красивые графики. </p>
<p>Чтобы подключить Сентри, сначала зарегистрируйся на <a href="https://sentry.io/signup/">https://sentry.io/signup/</a>, выбери в приветственном окне Python, появится инструкция по подключению его в проект. Там всё доходчиво описано — нужно установить пакет через pip, подключить его в проект, добавив пару строк кода с токеном и добавить в свой код какую-нибудь ошибку, например операцию деления на ноль, после чего вызвать этот код и получить ошибку в свой дашборд. Можешь выполнить это локально, на своем компьютере, чтобы проверить, а затем запушь код на GitHub и подтяни изменения на сервер, выполнив там команду <code>git pull</code>. Затем перезапусти бота на сервере. Не забудь обновить файл <code>.env</code>, внеся туда токен Сентри. </p>
<h2 id="_5">Что дальше?</h2>
<p>До встречи в следующем году)</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../../week4/telegram-api/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Назад
                </span>
                Telegram API
              </div>
            </div>
          </a>
        
        
          <a href="../../wtf/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Вперед
                </span>
                Что здесь происходит?
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            copyleft &copy; copyright
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.fd16492e.min.js"></script>
      <script src="../../assets/javascripts/bundle.7836ba4d.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "\u041a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0432 \u0431\u0443\u0444\u0435\u0440", "clipboard.copied": "\u0421\u043a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u043d\u043e \u0432 \u0431\u0443\u0444\u0435\u0440", "search.config.lang": "ru", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "\u041f\u043e\u0438\u0441\u043a", "search.result.placeholder": "\u041d\u0430\u0447\u043d\u0438\u0442\u0435 \u043f\u0435\u0447\u0430\u0442\u0430\u0442\u044c \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430", "search.result.none": "\u0421\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e", "search.result.one": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e 1 \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0435", "search.result.other": "\u041d\u0430\u0439\u0434\u0435\u043d\u043e # \u0441\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: ['navigation.tabs'],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>